<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不忘初心，光明前行。"><title>使用kubeadm安装kubernetes v1.12 | Shaojin's Words</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用kubeadm安装kubernetes v1.12</h1><a id="logo" href="/.">Shaojin's Words</a><p class="description">不忘初心，光明前行。</p></div><div id="nav-menu"><a href="/about/"><i class="fa fa-user"> 关于我</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">使用kubeadm安装kubernetes v1.12</h1><div class="post-meta"><a href="/2018/11/02/使用kubeadm安装kubernetes-v1-12/#comments" class="comment-count"></a><p><span class="date">Nov 02, 2018</span><span><a href="/categories/技术/" class="category">技术</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>目前大部分的kubernetes生产环境都是使用SaltStack、Ansible等运维工具自动化安装kebernetes的二进制文件，本身这些专业运维工具学习就比较费劲，而且用户还要自己编写配置文件、授权文件等，比较麻烦。有麻烦就有解决办法，kubeadm就是解决这些麻烦的，旨在通过kubeadm init和kubeadn join这两条指令一键部署kubernetes。但是截至目前，kubeadm还没有解决一键部署一个高可用的kubernetes集群问题。但是，kubeadm已经GA 版本了，离成功也已经不远了，而且使用kubeadm对理解kubernetes组件的工作方式和架构是非常有帮助的。<br>接下来我们就使用kubeadm全程用阿里云(不需要翻墙)来部署kubernetes集群。。</p>
<h2 id="一、准备环境"><a href="#一、准备环境" class="headerlink" title="一、准备环境"></a>一、准备环境</h2><p>1.操作系统<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># cat /etc/redhat-release </span></span><br><span class="line">CentOS Linux release 7.2.1511 (Core)</span><br></pre></td></tr></table></figure></p>
<p>所有主机操作系统相同，均为最小化安装</p>
<p>2.docker版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># docker -v</span></span><br><span class="line">Docker version 18.06.0-ce, build 0ffa825</span><br></pre></td></tr></table></figure></p>
<p>kubernetes 1.12最低支持的docker版本是1.11.1<br>3.kubernetes版本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># kubeadm version</span></span><br><span class="line">kubeadm version: &amp;version.Info&#123;Major:<span class="string">"1"</span>, Minor:<span class="string">"12"</span>, GitVersion:<span class="string">"v1.12.2"</span>, GitCommit:<span class="string">"17c77c7898218073f14c8d573582e8d2313dc740"</span>, GitTreeState:<span class="string">"clean"</span>, BuildDate:<span class="string">"2018-10-24T06:51:33Z"</span>, GoVersion:<span class="string">"go1.10.4"</span>, Compiler:<span class="string">"gc"</span>, Platform:<span class="string">"linux/amd64"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>4.各主机主机名及IP配置<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># cat /etc/hosts</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line"></span><br><span class="line">192.168.56.128 k8s-1</span><br><span class="line">192.168.56.129 k8s-2</span><br><span class="line">192.168.56.130 k8s-3</span><br></pre></td></tr></table></figure></p>
<p>本次实验一共3台主机，一台用于master部署，其他为node节点。</p>
<h2 id="二、架构图"><a href="#二、架构图" class="headerlink" title="二、架构图"></a>二、架构图</h2><p><img src="https://words-pictures.obs.cn-southwest-2.myhuaweicloud.com/23a32c8f8063d890ead169326b74bd4.png" alt=""></p>
<h2 id="三、安装前操作"><a href="#三、安装前操作" class="headerlink" title="三、安装前操作"></a>三、安装前操作</h2><h3 id="每台主机都必须执行的步骤"><a href="#每台主机都必须执行的步骤" class="headerlink" title="每台主机都必须执行的步骤"></a>每台主机都必须执行的步骤</h3><p>1.关闭并禁用防火墙<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># systemctl disable firewalld</span></span><br></pre></td></tr></table></figure></p>
<p>2.关闭selinux<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># sed -i 's/enforcing/disabled/' /etc/selinux/config</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># setenforce 0</span></span><br></pre></td></tr></table></figure></p>
<p>3.禁用swap<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># swapoff -a</span></span><br><span class="line">永久禁用的话修改/etc/fstab，注释swap，建议永久禁用，因为重启操作系统的话如果swap没禁用kubelet服务起不来。</span><br></pre></td></tr></table></figure></p>
<p>4.修改/etc/hosts文件<br>5.开启ipv4转发，启用bridge-nf-call-iptables和bridge-nf-call-ip6tables<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># echo "net.ipv4.ip_forward = 1"&gt;&gt;/etc/sysctl.conf</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># echo 'net.bridge.bridge-nf-call-iptables = 1'&gt;&gt;/etc/sysctl.conf</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># echo 'net.bridge.bridge-nf-call-ip6tables = 1'&gt;&gt;/etc/sysctl.conf</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># sysctl -p</span></span><br></pre></td></tr></table></figure></p>
<p>6.配置docker的yum源，并安装docker-ce-18.06.0<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># echo '[docker-ce-stable]</span></span><br><span class="line"> name=Docker CE Stable - <span class="variable">$basearch</span></span><br><span class="line"> baseurl=https://download.docker.com/linux/centos/7/<span class="variable">$basearch</span>/stable</span><br><span class="line"> enabled=1</span><br><span class="line"> gpgcheck=1</span><br><span class="line"> gpgkey=https://download.docker.com/linux/centos/gpg<span class="string">'&gt;/etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"><span class="string">[root@k8s-1 ~]# yum -y install docker-ce-18.06.0.ce-3.el7</span></span><br><span class="line"><span class="string">[root@k8s-1 ~]# systemctl start docker &amp;&amp; systemctl enable docker</span></span><br></pre></td></tr></table></figure></p>
<p>7.配置kubernetes阿里云镜像源<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># echo '[kubernetes]</span></span><br><span class="line">&gt; name=Kubernetes</span><br><span class="line">&gt; baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">&gt; enabled=1</span><br><span class="line">&gt; gpgcheck=1</span><br><span class="line">&gt; repo_gpgcheck=1</span><br><span class="line">&gt; gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg<span class="string">'&gt;/etc/yum.repos.d/kubernetes.repo</span></span><br></pre></td></tr></table></figure></p>
<h2 id="四、使用kubeadm部署kubernetes"><a href="#四、使用kubeadm部署kubernetes" class="headerlink" title="四、使用kubeadm部署kubernetes"></a>四、使用kubeadm部署kubernetes</h2><p>1.在每个节点安装kubeadm、kubelet、kubectl<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span></span><br><span class="line">[root@k8s-1 ~]<span class="comment"># systemctl enable kubelet &amp;&amp; systemctl start kubelet</span></span><br></pre></td></tr></table></figure></p>
<p>2.以下在master节点k8s-1上执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># kubeadm init --kubernetes-version=1.12.1 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.56.128</span></span><br><span class="line">[init] using Kubernetes version: v1.12.1</span><br><span class="line">[preflight] running pre-flight checks</span><br><span class="line">[preflight/images] Pulling images required <span class="keyword">for</span> setting up a Kubernetes cluster</span><br><span class="line">[preflight/images] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight/images] You can also perform this action <span class="keyword">in</span> beforehand using <span class="string">'kubeadm config images pull'</span></span><br><span class="line">[preflight] Some fatal errors occurred:</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-apiserver:v1.12.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-controller-manager:v1.12.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-scheduler:v1.12.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/kube-proxy:v1.12.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/pause:3.1: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/etcd:3.2.24: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">        [ERROR ImagePull]: failed to pull image k8s.gcr.io/coredns:1.2.2: output: Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled <span class="keyword">while</span> waiting <span class="keyword">for</span> connection (Client.Timeout exceeded <span class="keyword">while</span> awaiting headers)</span><br><span class="line">, error: <span class="built_in">exit</span> status 1</span><br><span class="line">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span><br></pre></td></tr></table></figure></p>
<p>报以上错误，就是因为不能翻墙。。。根据报错信息，在阿里云上下载相关镜像，然后修改标签。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver-amd64:v1.12.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager-amd64:v1.12.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler-amd64:v1.12.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.12.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd-amd64:3.2.24</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.2.2</span></span><br><span class="line">重新打tag</span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.2.2 k8s.gcr.io/coredns:1.2.2</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/etcd-amd64:3.2.24 k8s.gcr.io/etcd:3.2.24</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler-amd64:v1.12.1 k8s.gcr.io/kube-scheduler:v1.12.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager-amd64:v1.12.1 k8s.gcr.io/kube-controller-manager:v1.12.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver-amd64:v1.12.1 k8s.gcr.io/kube-apiserver:v1.12.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.12.1 k8s.gcr.io/kube-proxy:v1.12.1</span></span><br></pre></td></tr></table></figure></p>
<p>3.编辑以下配置文件/var/lib/kubelet/kubeadm-flags.env<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># echo 'KUBELET_KUBEADM_ARGS=--cgroup-driver=cgroupfs  --cni-bin-dir=/opt/cni/bin --cni-conf-dir=/etc/cni/net.d --network-plugin=cni'&gt;/var/lib/kubelet/kubeadm-flags.env</span></span><br></pre></td></tr></table></figure></p>
<p>本步骤主要是核实cgroup-driver=cgroupfs<br>4.重新初始化master<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 ~]<span class="comment"># kubeadm init --kubernetes-version=1.12.1 --pod-network-cidr=10.244.0.0/16 --apiserver-advertise-address=192.168.56.128</span></span><br></pre></td></tr></table></figure></p>
<p>初始化成功以后，根据提示执行以下步骤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">  sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">将其他两个节点加入集群，分别在两个节点执行以下命令：</span><br><span class="line">  kubeadm join 192.168.56.128:6443 --token 9azy5c.kpl624h4x73msiqz --discovery-token-ca-cert-hash sha256:b78daff96d6e4e59786df7c0431082799d41c66f61ac1f26caf3777c88ef7d60</span><br></pre></td></tr></table></figure></p>
<p>在注册集群的时候出现以下告警，是因为最小化安装操作系统没有包含该模块，对于实验和简单使用没有影响<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[WARNING RequiredIPVSKernelModulesAvailable]: the IPVS proxier will not be used, because the following required kernel modules are not loaded: [ip_vs ip_vs_rr ip_vs_wrr ip_vs_sh] or no <span class="built_in">builtin</span> kernel ipvs support: map[ip_vs:&#123;&#125; ip_vs_rr:&#123;&#125; ip_vs_wrr:&#123;&#125; ip_vs_sh:&#123;&#125; nf_conntrack_ipv4:&#123;&#125;]</span><br><span class="line">you can solve this problem with following methods:</span><br><span class="line">1. Run <span class="string">'modprobe -- '</span> to load missing kernel modules;</span><br><span class="line">2. Provide the missing <span class="built_in">builtin</span> kernel ipvs support</span><br></pre></td></tr></table></figure></p>
<p>5.安装flanel<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">在master节点执行：</span><br><span class="line">[root@k8s-1 ~]<span class="comment"># kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></span><br><span class="line">执行以下命令：</span><br><span class="line"><span class="comment"># kubectl get pod --all-namespaces</span></span><br><span class="line">看到有的pod不是running状态，使用describe查看发现其他节点还是因为被墙pull不下来镜像，还得去阿里云下载并改tag</span><br><span class="line"><span class="comment"># kubectl describe pod kube-flannel-ds-amd64-bbr75 --namespace=kube-system</span></span><br><span class="line">在其他两个节点执行以下命令：</span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.12.1</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy-amd64:v1.12.1 k8s.gcr.io/kube-proxy:v1.12.1</span></span><br><span class="line"><span class="comment"># docker pull registry.cn-hangzhou.aliyuncs.com/kubernetes_containers/flannel:v0.10.0-amd64</span></span><br><span class="line"><span class="comment"># docker tag registry.cn-hangzhou.aliyuncs.com/kubernetes_containers/flannel:v0.10.0-amd64 quay.io/coreos/flannel:v0.10.0-amd64</span></span><br><span class="line">再去看下，都是running</span><br><span class="line">[root@k8s-1 ~]<span class="comment"># kubectl get pods --all-namespaces</span></span><br><span class="line">NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-576cbf47c7-7wfhr                1/1     Running   7          3d</span><br><span class="line">kube-system   coredns-576cbf47c7-qdbzv                1/1     Running   7          3d</span><br><span class="line">kube-system   etcd-k8s-1                              1/1     Running   2          3d</span><br><span class="line">kube-system   kube-apiserver-k8s-1                    1/1     Running   2          3d</span><br><span class="line">kube-system   kube-controller-manager-k8s-1           1/1     Running   2          3d</span><br><span class="line">kube-system   kube-flannel-ds-amd64-bbr75             1/1     Running   3          3d</span><br><span class="line">kube-system   kube-flannel-ds-amd64-gq8v5             1/1     Running   2          3d</span><br><span class="line">kube-system   kube-flannel-ds-amd64-qd8cj             1/1     Running   3          3d</span><br><span class="line">kube-system   kube-proxy-d6cjg                        1/1     Running   2          3d</span><br><span class="line">kube-system   kube-proxy-ghkmk                        1/1     Running   2          3d</span><br><span class="line">kube-system   kube-proxy-rvr4j                        1/1     Running   2          3d</span><br><span class="line">kube-system   kube-scheduler-k8s-1                    1/1     Running   2          3d</span><br><span class="line">[root@k8s-1 ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME    STATUS   ROLES         AGE   VERSION</span><br><span class="line">k8s-1   Ready    edge,master   3d    v1.12.2</span><br><span class="line">k8s-2   Ready    &lt;none&gt;        3d    v1.12.2</span><br><span class="line">k8s-3   Ready    &lt;none&gt;        3d    v1.12.2</span><br><span class="line">[root@k8s-1 ~]<span class="comment"># kubectl get cs</span></span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">etcd-0               Healthy   &#123;<span class="string">"health"</span>: <span class="string">"true"</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>6.安装dashboard<br>在master节点执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /etc/kubernetes</span></span><br><span class="line"><span class="comment"># wget https://raw.githubusercontent.com/kubernetes/dashboard/master/src/deploy/recommended/kubernetes-dashboard.yaml</span></span><br></pre></td></tr></table></figure></p>
<p>编辑kubernetes-dashboard.yaml文件,修改镜像下载地址：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- name: kubernetes-dashboard</span><br><span class="line">  image: registry.cn-hangzhou.aliyuncs.com/google_containers/kubernetes-dashboard-amd64:v1.10.0</span><br></pre></td></tr></table></figure></p>
<p>master节点执行以下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl create -f kubernetes-dashboard.yaml</span></span><br></pre></td></tr></table></figure></p>
<p>查看pod dashboard是否正常，不正常的话describe看下，是不是没有pull下来镜像，如果没有pull下来再手动去提示的节点pull dashboard的镜像，pull下来以后再去看，就会正常。<br>7.授予Dashboard账户集群管理权限<br>需要一个管理集群admin的权限，新建kubernetes-dashboard-admin.rbac.yaml文件，内容如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-1 kubernetes]<span class="comment"># cat kubernetes-dashboard-admin.rbac.yaml </span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Create ClusterRoleBinding</span></span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kube-system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行命令：</span><br><span class="line"><span class="comment"># kubectl create -f kubernetes-dashboard-admin.rbac.yaml</span></span><br></pre></td></tr></table></figure></p>
<p>找到kubernete-dashboard-admin的token，用户登录使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl -n kube-system get secret | grep admin-user</span></span><br><span class="line"><span class="comment"># kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '&#123;print $1&#125;')</span></span><br></pre></td></tr></table></figure></p>
<p>这个token就是登陆用的，默认永久有效<br>8.dashboard的三种访问方式<br>第一.kubectl proxy方式访问<br>master上执行以下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kubectl proxy --address=0.0.0.0 --disable-filter=true</span></span><br></pre></td></tr></table></figure></p>
<p>即可通过浏览器访问: <a href="http://192.168.56.128:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login" target="_blank" rel="noopener">http://192.168.56.128:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/#!/login</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意：仪表盘使用kubectl代理命令不应暴露公开,因为它只允许HTTP连接。域以外的localhost和127.0.0.1将不能登录。在登录页面点击登录按钮什么都不会发生后，跳过登录后，没有任何权限。</span><br></pre></td></tr></table></figure></p>
<p>第二.NodePort方式访问<br>这种访问方式仪表板只建议在单个节点上设置开发环境。</p>
<p>编辑kubernetes-dashboard.yaml文件，添加type: NodePort和nodePort: 30001，暴露Dashboard服务为30001端口,参考如下；<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ------------------- Dashboard Service ------------------- #</span></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort  <span class="comment"># NodePort登录方式</span></span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 8443</span><br><span class="line">      nodePort: 30001  <span class="comment"># NodePort登录暴露端口</span></span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br></pre></td></tr></table></figure></p>
<p>使用节点ip和port访问   https://<master-ip>:<nodeport><br>第三.API Server方式访问(推荐访问方式)（好像只能用谷歌内核的浏览器）<br>使用以下访问   https://<master-ip>:<apiserver-port>/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/<br>例如：<a href="https://192.168.56.128:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" target="_blank" rel="noopener">https://192.168.56.128:6443/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/</a><br>浏览器访问问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  &quot;kind&quot;: &quot;Status&quot;,</span><br><span class="line">  &quot;apiVersion&quot;: &quot;v1&quot;,</span><br><span class="line">  &quot;metadata&quot;: &#123;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;status&quot;: &quot;Failure&quot;,</span><br><span class="line">  &quot;message&quot;: &quot;services \&quot;https:kubernetes-dashboard:\&quot; is forbidden: User \&quot;system:anonymous\&quot; cannot get services/proxy in the namespace \&quot;kube-system\&quot;&quot;,</span><br><span class="line">  &quot;reason&quot;: &quot;Forbidden&quot;,</span><br><span class="line">  &quot;details&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;https:kubernetes-dashboard:&quot;,</span><br><span class="line">    &quot;kind&quot;: &quot;services&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;code&quot;: 403</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></apiserver-port></master-ip></nodeport></master-ip></p>
<p>这是因为最新版的k8s默认启用了RBAC，并为未认证用户赋予了一个默认的身份：anonymous,对于API Server来说，它是使用证书进行认证的<br>我们需要先创建一个证书：<br> 首先找到kubectl命令的配置文件，默认情况下为/etc/kubernetes/admin.conf，在 上文 中，我们已经复制到了$HOME/.kube/config中。</p>
<p>然后我们使用client-certificate-data和client-key-data生成一个p12文件，可使用下列命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成client-certificate-data</span></span><br><span class="line">grep <span class="string">'client-certificate-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt;&gt; kubecfg.crt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成client-key-data</span></span><br><span class="line">grep <span class="string">'client-key-data'</span> ~/.kube/config | head -n 1 | awk <span class="string">'&#123;print $2&#125;'</span> | base64 -d &gt;&gt; kubecfg.key</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成p12</span></span><br><span class="line">openssl pkcs12 -<span class="built_in">export</span> -clcerts -inkey kubecfg.key -<span class="keyword">in</span> kubecfg.crt -out kubecfg.p12 -name <span class="string">"kubernetes-client"</span></span><br></pre></td></tr></table></figure></p>
<p>最后在浏览器里导入上面生成的p12文件，重新打开浏览器，显示出现选择证书选项，选OK，然后就可以看到熟悉的登录界面了。我们可以使用一开始创建的admin-user用户的token进行登录，一切OK。<br><img src="https://words-pictures.obs.cn-southwest-2.myhuaweicloud.com/c12f9ec84b9918729279c66ffb714a3.png" alt=""><br>终于大功告成了！</p>
</div><div class="tags"><a href="/tags/kubetnetes/">kubetnetes</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div><div class="jiathis_style"><span class="jiathis_txt">分享到：</span><a class="jiathis_button_tsina"></a><a class="jiathis_button_qzone"></a><a class="jiathis_button_weixin"></a><a class="jiathis_button_fb"></a><a class="jiathis_button_linkedin"></a><a class="jiathis_button_twitter"></a><a class="jiathis_button_ydnote"></a><a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis"></a><a class="jiathis_counter_style"></a></div></div><div class="post-nav"><a href="/2018/12/11/kubernetes中YAML文件学习/" class="pre">kubernetes中YAML文件学习</a><a href="/2018/07/05/两个神奇的命令/" class="next">两个神奇的命令</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、准备环境"><span class="toc-text">一、准备环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、架构图"><span class="toc-text">二、架构图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、安装前操作"><span class="toc-text">三、安装前操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#每台主机都必须执行的步骤"><span class="toc-text">每台主机都必须执行的步骤</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、使用kubeadm部署kubernetes"><span class="toc-text">四、使用kubeadm部署kubernetes</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/11/10/交易的技术/">交易的技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/04/财务报表中的关键数据/">财务报表中的关键数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/01/华为交换机常用配置/">华为交换机常用配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/31/2018年过去了，我很怀念它/">2018年过去了，我很怀念它</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/13/kubernetes中pod对象学习/">kubernetes中pod对象学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/kubernetes中YAML文件学习/">kubernetes中YAML文件学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/使用kubeadm安装kubernetes-v1-12/">使用kubeadm安装kubernetes v1.12</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/05/两个神奇的命令/">两个神奇的命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/13/2018年俄罗斯世界杯/">2018年俄罗斯世界杯</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/27/读苏轼与杂谈/">读苏轼与杂谈</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/投资/">投资</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/世界杯/" style="font-size: 15px;">世界杯</a> <a href="/tags/ceph/" style="font-size: 15px;">ceph</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/2019-2018-总结/" style="font-size: 15px;">2019 2018 总结</a> <a href="/tags/openstack/" style="font-size: 15px;">openstack</a> <a href="/tags/生活/" style="font-size: 15px;">生活</a> <a href="/tags/kubetnetes/" style="font-size: 15px;">kubetnetes</a> <a href="/tags/zabbix/" style="font-size: 15px;">zabbix</a> <a href="/tags/投资-交易/" style="font-size: 15px;">投资  交易</a> <a href="/tags/交换机/" style="font-size: 15px;">交换机</a> <a href="/tags/苏轼/" style="font-size: 15px;">苏轼</a> <a href="/tags/投资/" style="font-size: 15px;">投资</a> <a href="/tags/诗句/" style="font-size: 15px;">诗句</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://www.lijiawang.org" title="李加旺" target="_blank">李加旺</a><ul></ul><a href="www.chenshake.com" title="陈沙克" target="_blank">陈沙克</a><ul></ul><a href="https://lingxiankong.github.io" title="孔令贤" target="_blank">孔令贤</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">程少进.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?7eddd2bf8541725892a4340500873263";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>var jiathis_config={
    data_track_clickback:true,
    summary:"",
    shortUrl:true,
    hideMore:false
}</script><script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script></body></html>